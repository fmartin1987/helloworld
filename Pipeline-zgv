pipeline {
    agent {
        label 'maven'
    }
    stages {
        stage('SCM') {
            steps {
                git 'https://github.com/fmartin1987/helloworld.git'
            }
        }
        stage('Code Analysis') {
            steps {
                script {
                    sh 'mvn sonar:sonar ' +
                       '-Dsonar.host.url=http://sonarqube.cicd.zgv-apps.oc.nologin.es ' +
                       '-Dsonar.projectKey=cicd-test ' +
                       '-Dsonar.sources=/tmp/workspace/cicd-test ' +
                       '-Dsonar.projectBaseDir=/tmp/workspace/cicd-test'
                }
            }
        }
        stage('Compilation') {
            steps {
                script {
                    sh 'mvn -f pom.xml clean compile package'
                }
            }
        }
        stage('Upload to Repository') {
            steps {
                script {
                    sh 'mvn -s Settings.xml deploy:deploy-file ' +
                       '-DrepositoryId=Nexus ' +
                       '-Durl=http://nexus.cicd.zgv-apps.oc.nologin.es/repository/maven-releases ' +
                       '-DgroupId=fmartin1987 ' +
                       '-DartifactId=HelloWorld ' +
                       '-Dversion=1.0 ' +
                       '-Dpackaging=jar ' +
                       '-Dfile=/tmp/workspace/cicd-test/target/HelloWorld-1.0.jar'
                }
            }
        }
    }
}
